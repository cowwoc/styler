{
  "schema_version": "2.0",
  "description": "Retrospective history and recurring pattern tracker with timestamp-based effectiveness analysis",
  "documentation": {
    "trigger_logic": "Retrospective triggered when mistake_count_since_last >= threshold OR days since last >= interval",
    "effectiveness_logic": "Pattern recurrence = mistakes WHERE pattern_id = X AND timestamp > action_item.completed_date. If recurrence >= 1, action item marked ineffective and escalated.",
    "data_retention": "Mistakes never deleted. Counters reset only for triggering. Full audit trail preserved."
  },
  "config": {
    "trigger_interval_days": 14,
    "mistake_count_threshold": 10,
    "recurrence_threshold": 2,
    "recurrence_after_fix_threshold": 1,
    "ineffective_action_escalation": true,
    "effectiveness_monitoring_enabled": true,
    "effectiveness_check_on_new_mistake": true
  },
  "escalations": [
    {
      "id": "ESCALATE-2026-01-08-001",
      "original_action_id": "A004",
      "original_fix_description": "Git operation skills with backup-verify-cleanup pattern",
      "failure_analysis": {
        "expected_result": "Prevent all git operation failures through backup-verify-cleanup",
        "actual_result": "3 new git failures (M025, M026, M033) in period",
        "root_cause": "Skills cover squash/rebase but not destructive commands (reflog expire, gc prune) or file extraction from stale commits",
        "gap_identified": "Missing coverage for destructive commands and stale-base operations"
      },
      "proposed_solution": {
        "approach": "defense-in-depth",
        "description": "Add PreToolUse hook to block destructive git commands",
        "prevention_type": "hook",
        "layers": [
          "PreToolUse validation for dangerous git commands",
          "Warn on file extraction from non-HEAD commits"
        ]
      },
      "priority": "high",
      "status": "open"
    }
  ],
  "last_retrospective": "2026-01-08T12:00:00-05:00",
  "mistake_count_since_last": 12,
  "retrospectives": [
    {
      "id": "R002",
      "timestamp": "2026-01-08T12:00:00-05:00",
      "session_id": "e48f17a9-fe8f-4a6c-88fc-afca8a2176dd",
      "trigger": "user_requested",
      "period_analyzed": "2025-11-28 to 2026-01-08",
      "mistakes_analyzed": 20,
      "summary": "20 mistakes analyzed across 6 categories. protocol_violation (7) is the highest category indicating workflow checkpoint gaps. 3 new patterns identified. A004 (git operations) escalated due to 3 new failures.",
      "findings": {
        "by_category": {
          "protocol_violation": 7,
          "build_failure": 4,
          "git_operation_failure": 3,
          "test_failure": 3,
          "logical_error": 2,
          "detection_gap": 1
        },
        "action_item_effectiveness": {
          "A001": "effective",
          "A002": "effective",
          "A003": "partially_effective",
          "A004": "escalated"
        },
        "new_patterns_identified": [
          "PATTERN-004",
          "PATTERN-005",
          "PATTERN-006"
        ]
      }
    },
    {
      "id": "R001",
      "timestamp": "2025-11-28T08:30:00-05:00",
      "session_id": "a2b830b7-9991-4be0-b4b1-34ee93aeba7f",
      "trigger": "user_requested",
      "period_analyzed": "2025-11-05 to 2025-11-28",
      "mistakes_analyzed": 21,
      "summary": "Comprehensive retrospective of all mistakes since project inception. Identified 21 distinct mistake patterns across 7 categories. Created prevention infrastructure including 48 hooks and multiple skills.",
      "findings": {
        "by_category": {
          "detection_gap": 7,
          "git_operation_failure": 4,
          "protocol_violation": 3,
          "build_failure": 3,
          "giving_up": 2,
          "documentation_violation": 2,
          "worktree_violation": 1
        },
        "by_prevention_type": {
          "hook": 11,
          "skill": 4,
          "validation": 2,
          "documentation": 2,
          "config": 1,
          "code_fix": 1
        },
        "high_recurrence": [
          {
            "id": "M017",
            "category": "build_failure",
            "recurrence": 4,
            "description": "Checkstyle violations"
          },
          {
            "id": "M018",
            "category": "build_failure",
            "recurrence": 3,
            "description": "PMD violations"
          }
        ]
      }
    }
  ],
  "recurring_patterns": [
    {
      "pattern_id": "PATTERN-001",
      "pattern": "git_operation_failure",
      "occurrences_total": 4,
      "occurrences_after_fix": 0,
      "first_seen": "2025-11-05",
      "last_seen": "2025-11-12",
      "last_action_date": "2025-11-12",
      "status": "addressed",
      "effectiveness": "effective",
      "preventions": [
        "git-squash skill with verification",
        "git-rebase skill with backup",
        "auto-learn-from-mistakes Pattern 7"
      ],
      "related_action_items": [
        "A004"
      ]
    },
    {
      "pattern_id": "PATTERN-002",
      "pattern": "detection_gap",
      "occurrences_total": 7,
      "occurrences_after_fix": 0,
      "first_seen": "2025-11-05",
      "last_seen": "2025-11-27",
      "last_action_date": "2025-11-27",
      "status": "ongoing",
      "effectiveness": "partial",
      "preventions": [
        "auto-learn-from-mistakes hook (11 patterns)",
        "Various specialized detection hooks"
      ],
      "related_action_items": [
        "A003"
      ],
      "note": "Most common category - each new detection gap leads to new pattern in hook"
    },
    {
      "pattern_id": "PATTERN-003",
      "pattern": "build_failure",
      "occurrences_total": 3,
      "occurrences_after_fix": 0,
      "first_seen": "2025-11-27",
      "last_seen": "2025-11-27",
      "last_action_date": "2025-11-28",
      "status": "addressed",
      "effectiveness": "pending_verification",
      "preventions": [
        "mvn checkstyle:check",
        "mvn pmd:check",
        "pre-commit hook validation (A001)"
      ],
      "related_action_items": [
        "A001"
      ],
      "note": "Pre-commit hook added 2025-11-28 - blocks commits with style violations"
    },
    {
      "pattern_id": "PATTERN-004",
      "pattern": "protocol_violation",
      "occurrences_total": 7,
      "occurrences_after_fix": 0,
      "first_seen": "2026-01-05",
      "last_seen": "2026-01-08",
      "last_action_date": null,
      "status": "new",
      "effectiveness": "pending",
      "preventions": [],
      "related_action_items": [
        "A005"
      ],
      "note": "New pattern - workflow checkpoint gaps causing plan/commit/path issues"
    },
    {
      "pattern_id": "PATTERN-005",
      "pattern": "test_failure",
      "occurrences_total": 3,
      "occurrences_after_fix": 0,
      "first_seen": "2026-01-05",
      "last_seen": "2026-01-06",
      "last_action_date": null,
      "status": "new",
      "effectiveness": "pending",
      "preventions": [],
      "related_action_items": [
        "A006"
      ],
      "note": "New pattern - weak test assertions and blind position copying"
    },
    {
      "pattern_id": "PATTERN-006",
      "pattern": "git_operation_failure",
      "occurrences_total": 3,
      "occurrences_after_fix": 0,
      "first_seen": "2026-01-05",
      "last_seen": "2026-01-06",
      "last_action_date": null,
      "status": "new",
      "effectiveness": "pending",
      "preventions": [],
      "related_action_items": [
        "A007"
      ],
      "note": "Extension of PATTERN-001 - destructive commands and stale-base operations"
    }
  ],
  "action_items": [
    {
      "id": "A001",
      "priority": "high",
      "description": "Add pre-commit hook for checkstyle/PMD validation to catch style violations before commit",
      "category": "build_failure",
      "pattern_id": "PATTERN-003",
      "status": "implemented",
      "created_date": "2025-11-28T08:30:00-05:00",
      "completed_date": "2025-11-28T14:00:00-05:00",
      "related_mistakes": [
        "M017",
        "M018"
      ],
      "effectiveness_check": {
        "mistakes_before": 3,
        "mistakes_after": 0,
        "post_fix_mistakes": [],
        "verdict": "pending_verification"
      },
      "implementation_note": "Added checkstyle:check and pmd:check to .git/hooks/pre-commit - blocks commits with violations"
    },
    {
      "id": "A002",
      "priority": "medium",
      "description": "TDD enforcement via tdd-skill-gate.sh for all Java production code",
      "category": "tdd_violation",
      "pattern_id": null,
      "status": "implemented",
      "created_date": "2025-11-28T08:00:00-05:00",
      "completed_date": "2025-11-28T08:03:00-05:00",
      "related_mistakes": [],
      "effectiveness_check": {
        "mistakes_before": 0,
        "mistakes_after": 0,
        "post_fix_mistakes": [],
        "verdict": "effective"
      },
      "note": "Proactive prevention based on identified TDD enforcement patterns"
    },
    {
      "id": "A003",
      "priority": "medium",
      "description": "Add cross-session mistake logging to learn-from-mistakes skill",
      "category": "detection_gap",
      "pattern_id": "PATTERN-002",
      "status": "implemented",
      "created_date": "2025-11-28T08:00:00-05:00",
      "completed_date": "2025-11-28T08:05:00-05:00",
      "related_mistakes": [
        "M011"
      ],
      "effectiveness_check": {
        "mistakes_before": 7,
        "mistakes_after": 0,
        "post_fix_mistakes": [],
        "verdict": "effective"
      },
      "note": "Implemented as Phase 9 in learn-from-mistakes skill"
    },
    {
      "id": "A004",
      "priority": "high",
      "description": "Git operation skills with backup-verify-cleanup pattern",
      "category": "git_operation_failure",
      "pattern_id": "PATTERN-001",
      "status": "implemented",
      "created_date": "2025-11-06T00:00:00-05:00",
      "completed_date": "2025-11-12T00:00:00-05:00",
      "related_mistakes": [
        "M001",
        "M002",
        "M003",
        "M006",
        "M010"
      ],
      "effectiveness_check": {
        "mistakes_before": 4,
        "mistakes_after": 3,
        "post_fix_mistakes": [
          "M025",
          "M026",
          "M033"
        ],
        "verdict": "escalated"
      },
      "escalation": "ESCALATE-2026-01-08-001"
    },
    {
      "id": "A005",
      "priority": "high",
      "description": "Add mandatory checkpoint enforcement to workflow skills for plan changes, user review, get-history, retrospectives logging, and path format validation",
      "category": "protocol_violation",
      "pattern_id": "PATTERN-004",
      "status": "open",
      "created_date": "2026-01-08T12:00:00-05:00",
      "completed_date": null,
      "related_mistakes": [
        "M028",
        "M034",
        "M035",
        "M037",
        "M038",
        "M040",
        "M041"
      ],
      "effectiveness_check": {
        "mistakes_before": 7,
        "mistakes_after": null,
        "post_fix_mistakes": [],
        "verdict": "pending"
      }
    },
    {
      "id": "A006",
      "priority": "medium",
      "description": "Strengthen parser test documentation: prohibit weak assertions (isNotNull on arenas), require position verification, add anti-pattern examples",
      "category": "test_failure",
      "pattern_id": "PATTERN-005",
      "status": "open",
      "created_date": "2026-01-08T12:00:00-05:00",
      "completed_date": null,
      "related_mistakes": [
        "M027",
        "M031",
        "M032"
      ],
      "effectiveness_check": {
        "mistakes_before": 3,
        "mistakes_after": null,
        "post_fix_mistakes": [],
        "verdict": "pending"
      }
    },
    {
      "id": "A007",
      "priority": "high",
      "description": "Add PreToolUse hook to block destructive git commands (reflog expire, gc --prune) and warn on file extraction from non-HEAD commits",
      "category": "git_operation_failure",
      "pattern_id": "PATTERN-006",
      "status": "open",
      "created_date": "2026-01-08T12:00:00-05:00",
      "completed_date": null,
      "related_mistakes": [
        "M025",
        "M026",
        "M033"
      ],
      "effectiveness_check": {
        "mistakes_before": 3,
        "mistakes_after": null,
        "post_fix_mistakes": [],
        "verdict": "pending"
      },
      "escalation_of": "A004"
    }
  ],
  "effectiveness_analysis_query": "jq --arg pattern_id \"PATTERN-XXX\" --arg completed_date \"YYYY-MM-DD\" '[.mistakes[] | select(.pattern_id == $pattern_id and .timestamp > $completed_date)] | length' .claude/retrospectives/mistakes.json"
}
