{
  "schema_version": "2.0",
  "description": "Retrospective history and recurring pattern tracker with timestamp-based effectiveness analysis",
  "documentation": {
    "trigger_logic": "Retrospective triggered when mistake_count_since_last >= threshold OR days since last >= interval",
    "effectiveness_logic": "Pattern recurrence = mistakes WHERE pattern_id = X AND timestamp > action_item.completed_date. If recurrence >= 1, action item marked ineffective and escalated.",
    "data_retention": "Mistakes never deleted. Counters reset only for triggering. Full audit trail preserved."
  },
  "config": {
    "trigger_interval_days": 14,
    "mistake_count_threshold": 10,
    "recurrence_threshold": 2,
    "recurrence_after_fix_threshold": 1,
    "ineffective_action_escalation": true,
    "effectiveness_monitoring_enabled": true,
    "effectiveness_check_on_new_mistake": true
  },
  "escalations": [],
  "last_retrospective": "2025-11-28T08:30:00-05:00",
  "mistake_count_since_last": 5,
  "retrospectives": [
    {
      "id": "R001",
      "timestamp": "2025-11-28T08:30:00-05:00",
      "session_id": "a2b830b7-9991-4be0-b4b1-34ee93aeba7f",
      "trigger": "user_requested",
      "period_analyzed": "2025-11-05 to 2025-11-28",
      "mistakes_analyzed": 21,
      "summary": "Comprehensive retrospective of all mistakes since project inception. Identified 21 distinct mistake patterns across 7 categories. Created prevention infrastructure including 48 hooks and multiple skills.",
      "findings": {
        "by_category": {
          "detection_gap": 7,
          "git_operation_failure": 4,
          "protocol_violation": 3,
          "build_failure": 3,
          "giving_up": 2,
          "documentation_violation": 2,
          "worktree_violation": 1
        },
        "by_prevention_type": {
          "hook": 11,
          "skill": 4,
          "validation": 2,
          "documentation": 2,
          "config": 1,
          "code_fix": 1
        },
        "high_recurrence": [
          {
            "id": "M017",
            "category": "build_failure",
            "recurrence": 4,
            "description": "Checkstyle violations"
          },
          {
            "id": "M018",
            "category": "build_failure",
            "recurrence": 3,
            "description": "PMD violations"
          }
        ]
      }
    }
  ],
  "recurring_patterns": [
    {
      "pattern_id": "PATTERN-001",
      "pattern": "git_operation_failure",
      "occurrences_total": 4,
      "occurrences_after_fix": 0,
      "first_seen": "2025-11-05",
      "last_seen": "2025-11-12",
      "last_action_date": "2025-11-12",
      "status": "addressed",
      "effectiveness": "effective",
      "preventions": [
        "git-squash skill with verification",
        "git-rebase skill with backup",
        "auto-learn-from-mistakes Pattern 7"
      ],
      "related_action_items": [
        "A004"
      ]
    },
    {
      "pattern_id": "PATTERN-002",
      "pattern": "detection_gap",
      "occurrences_total": 7,
      "occurrences_after_fix": 0,
      "first_seen": "2025-11-05",
      "last_seen": "2025-11-27",
      "last_action_date": "2025-11-27",
      "status": "ongoing",
      "effectiveness": "partial",
      "preventions": [
        "auto-learn-from-mistakes hook (11 patterns)",
        "Various specialized detection hooks"
      ],
      "related_action_items": [
        "A003"
      ],
      "note": "Most common category - each new detection gap leads to new pattern in hook"
    },
    {
      "pattern_id": "PATTERN-003",
      "pattern": "build_failure",
      "occurrences_total": 3,
      "occurrences_after_fix": 0,
      "first_seen": "2025-11-27",
      "last_seen": "2025-11-27",
      "last_action_date": "2025-11-28",
      "status": "addressed",
      "effectiveness": "pending_verification",
      "preventions": [
        "mvn checkstyle:check",
        "mvn pmd:check",
        "pre-commit hook validation (A001)"
      ],
      "related_action_items": [
        "A001"
      ],
      "note": "Pre-commit hook added 2025-11-28 - blocks commits with style violations"
    }
  ],
  "action_items": [
    {
      "id": "A001",
      "priority": "high",
      "description": "Add pre-commit hook for checkstyle/PMD validation to catch style violations before commit",
      "category": "build_failure",
      "pattern_id": "PATTERN-003",
      "status": "implemented",
      "created_date": "2025-11-28T08:30:00-05:00",
      "completed_date": "2025-11-28T14:00:00-05:00",
      "related_mistakes": [
        "M017",
        "M018"
      ],
      "effectiveness_check": {
        "mistakes_before": 3,
        "mistakes_after": 0,
        "post_fix_mistakes": [],
        "verdict": "pending_verification"
      },
      "implementation_note": "Added checkstyle:check and pmd:check to .git/hooks/pre-commit - blocks commits with violations"
    },
    {
      "id": "A002",
      "priority": "medium",
      "description": "TDD enforcement via tdd-skill-gate.sh for all Java production code",
      "category": "tdd_violation",
      "pattern_id": null,
      "status": "implemented",
      "created_date": "2025-11-28T08:00:00-05:00",
      "completed_date": "2025-11-28T08:03:00-05:00",
      "related_mistakes": [],
      "effectiveness_check": {
        "mistakes_before": 0,
        "mistakes_after": 0,
        "post_fix_mistakes": [],
        "verdict": "effective"
      },
      "note": "Proactive prevention based on identified TDD enforcement patterns"
    },
    {
      "id": "A003",
      "priority": "medium",
      "description": "Add cross-session mistake logging to learn-from-mistakes skill",
      "category": "detection_gap",
      "pattern_id": "PATTERN-002",
      "status": "implemented",
      "created_date": "2025-11-28T08:00:00-05:00",
      "completed_date": "2025-11-28T08:05:00-05:00",
      "related_mistakes": [
        "M011"
      ],
      "effectiveness_check": {
        "mistakes_before": 7,
        "mistakes_after": 0,
        "post_fix_mistakes": [],
        "verdict": "effective"
      },
      "note": "Implemented as Phase 9 in learn-from-mistakes skill"
    },
    {
      "id": "A004",
      "priority": "high",
      "description": "Git operation skills with backup-verify-cleanup pattern",
      "category": "git_operation_failure",
      "pattern_id": "PATTERN-001",
      "status": "implemented",
      "created_date": "2025-11-06T00:00:00-05:00",
      "completed_date": "2025-11-12T00:00:00-05:00",
      "related_mistakes": [
        "M001",
        "M002",
        "M003",
        "M006",
        "M010"
      ],
      "effectiveness_check": {
        "mistakes_before": 4,
        "mistakes_after": 0,
        "post_fix_mistakes": [],
        "verdict": "effective"
      }
    }
  ],
  "effectiveness_analysis_query": "jq --arg pattern_id \"PATTERN-XXX\" --arg completed_date \"YYYY-MM-DD\" '[.mistakes[] | select(.pattern_id == $pattern_id and .timestamp > $completed_date)] | length' .claude/retrospectives/mistakes.json"
}
